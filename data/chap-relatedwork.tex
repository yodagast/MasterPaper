% !Mode:: "TeX:UTF-8"
%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:

% 绪论和个人工作

\chapter{知识库补全研究现状}
\label{cha:related-work}

当前知识库相关的研究主要分为三个方面：（1）知识库的构建，各种基于互联网的、通用的、领域内的知识库构建。
（2）关系机器学习，基于已经构建好的知识库进行关系预测，知识库补全推理等。（3）知识库应用系统。如基于知识库的问答系统，
基于知识库的信息检索系统，生物、金融、教育等领域的本体知识库的应用等。其中研究的热点之一就是知识库补全推理，或者说如何发掘知识库中实体和实体之间隐藏的关系。

当前存在的知识库系统如NELL、Knowledge Vault等，尽管已经包含了大量的实体、关系和属性，但这类知识库中很多实体和实体之间的关系任然是缺失的。例如，尽管知识库中存在很多三元组如：北师大，位于,北京；北京，位于,中国。但是当预测北师大是否位于中国时，通常计算机很难直接进行这类常识性的推理。如何构建一个辅助计算机进行常识推理的系统，发现知识库中隐藏的实体和实体之间的关系，是知识库补全系统的重要任务之一。当前有很多基于表示学习和基于符号逻辑的知识库补全算法被提出，这类算法都是基于知识库中现有的关系类型去预测知识库中未知的关系。但是在知识库中存在大量的属性事实型三元组未被使用，而这些属性事实三元组在进行关系预测时有很重要的作用，如：A，isMarriedTo，B；A，HasChild，C。当预测B是否是C的父母时，这些相关实体的年龄、性别等实体属性也很重要，如何能处理不同类型的实体属性特征，将其用于知识库补全系统中，是知识库补全工作的一个重要探索点。

在构建知识库补全系统的过程中，基于符号逻辑的算法通常通过训练一个二分类的分类器来判断实体和实体之间是否具有某种关系。通常这个分类器的正例是通过抽取现有知识库中存在的三元组作为正例，或称之为正例三元组，而负例则是采用随机采样等方法生成负例三元组。通常在知识库补全系统中，每个正例三元组可以构建上百组不同种类的负例三元组，如何解决正负例三元组不均衡的问题，正确预测实体和实体之间的关系，也是知识库补全算法的一个重要优化方向。

\section{知识库构建和应用}
在知识库构建过程中，数据完整性、数据精确性和数据质量是构建知识库的重要指标，
通常知识库可以由三元组组成。知识库的构建可以有多种方法：
（1）通过机器学习和自然语言处理技术自动抽取三元组\cite{Weikum2010FromIT}进行构建。
（2）半自动抽取的方法，通过从维基百科等网站的infobox基于规则模式抽取三元组。
（3）基于协同创作\cite{Mitraka2015WikidataAP}的方法，通过众包的形式系统创建知识库。
（4）基于专家知识构建的领域内知识库，这些领域知识库有较高的专业性。

\subsection{YAGO知识库}
YAGO是一个从维基百科上抽取的、包含地理名词、WordNet\cite{Kasneci2008TheYA}等数据的知识库。
YAGO将WordNet的词汇定义与维基百科的分类体系进行了融合集成\cite{Suchanek2008YAGOAL}，并集成了多种地理类型的数据，使得YAGO具有更加丰富的实体分类体系。YAGO还考虑了时间和空间知识\cite{Hoffart2011YAGO2EA}，为很多知识条目增加了时间和空间维度的属性描述。目前，YAGO包含1.2亿条结合关系三元组和实体属性三元组的知识。YAGO也是IBM Watson\cite{Ferrucci2010BuildingWA}的后端知识库之一。
YAGO2\cite{Hoffart2013YAGO2AS}是YAGO的一个实例，当前YAGO2包括超过260万的实体和超过1.2亿的关系三元组知识，我们使用了其中实体的关系型三元组和属性型三元组共有4,484,914条、
37种关系型三元组的事实描述，同时有3,353,659条、35种属性性三元组的事实描述。

\subsection{Freebase知识库}
Freebase\cite{Bollacker2008FreebaseAC}是一个协同创作的知识库系统，内容通过用户添加，所有的条目采用结构化的形式，将结构分为三次：领域-类型-主题，其中，每一个条目叫做一个主题，每个主题包含不同的属性类型，一些同类型的主题组成一个类型，所有相关的类型构成一个领域。
这种通过协同创作方式创建了结构化的人类知识，截止2007年Freebase包含1.25亿条三元组，超过4000种类型和超过7000种属性知识。一些基于Freebase研究结构化知识的问答系统\cite{Yao2014InformationEO}\cite{Yao2015LeanQA},关注Freebase中的信息抽取和语义解析\cite{Yao2014FreebaseQI},也有一些研究关注Freebase中的实体消除歧义问题\cite{Zheng2012EntityDW}。

除了YAGO和Freebase知识库，也有很多重要的知识库如：Google Knowledge Graph，Wikidata，DBpedia等，这些通用的数据库都有着各自的特点和特色，表\ref{tab:addlabel-kb-list}展示了不同类型的知识库的实体、关系类型和三元组等数量，其中的M表示百万数量。本研究中的实验考虑到同时使用属性三元组和实体关系三元组，从而选择在YAGO和Freebase数据集中筛选属性特征较多的实体，
构建两个子数据集进行模型训练。

% Table generated by Excel2LaTeX from sheet '知识库'
\begin{table}[htbp]
  \centering
  \caption{不同知识库数据统计}
    \begin{tabular}{|l|l|r|l|}
    \hline
    知识库   & 实体数量  & \multicolumn{1}{l|}{关系类型数量} & 三元组数量 \\
    \hline
    Knowledge Graph & 570M  & 35000 & 18000M \\
    \hline
    YAGO2 & 9.8M  & 114   & 447M \\
    \hline
    DBpedia & 4.6M  & 1367  & 538M \\
    \hline
    Wikidata & 18M   & 1632  & 66M \\
    \hline
    Freebase & 40M   & 35000 & 637M \\
    \hline
    \end{tabular}%
  \label{tab:addlabel-kb-list}%
\end{table}%


在通过自动、半自动的信息抽取、专家知识构建知识库后，有着各种各样广泛的应用，
并能辅助人们检索、学习通用知识；一些专家对领域内的知识进行有序化，规范化，
辅助人们去了解学习一个领域的专业知识。

知识库最广泛的应用是谷歌和微软等商业公司的信息检索系统，2014年谷歌提出的知识图谱\cite{Dong2014KnowledgeVA}就是结合FreeBase、Wikidata以及各种互联网数据进行信息抽取、
知识整合后的著名系统，谷歌也在其博客上讲述了如何将知识库应用在实际的检索中，
微软的Satori也是一个类似的知识库系统,被必应搜索广泛应用。其他搜索公司如百度、搜狗等公司都在知识库构建和信息检索领域有各自的应用，
对于每一个用户搜索的关键词，我们可以通过知识库系统来返回更丰富，更全面的信息。比如搜索一个企业法人的姓名，我们的智能搜索引擎可以返回与这个人相关的所有历史借款记录、联系人信息、行为特征等。另外我们通过可视化把复杂的信息以非常直观的方式呈现出来， 使得用户对于对隐藏信息的来龙去脉一目了然。

基于知识库的问答系统也有广泛的发展，2000年就有人提出基于知识的问答系统\cite{HERMJAKOB2000KnowledgeBasedQA}，通过构架知识库完成问答。
也有很多方法基于知识库进行表示学习\cite{Yang2014JointRE}，通过学习实体的低维度表示，学习知识库的实体和实体之间的关系，然后构建相关的知识库问答系统。
还有一些基于标签语义解析的方法，构建知识库问答系统\cite{Yih2016TheVO}。
一些论文\cite{Yu2017ImprovedNR}研究结合深度学习、关系抽取和问答系统，从而获得更好的知识库问答效果。
一些论文\cite{KeySun2016OpenKB}研究基于开放的知识库构建开放领域的问答系统，期望能基于百科知识进行问答系统构建。
也有基于知识库的系统通过结合智能计算\cite{Pandey2009KnowledgeAI}，在医疗诊断领域获得一些突破。
也有一些研究结合了知识库和医疗图像信息\cite{Halpern2014EvaluationOC}，对一些医疗疾病进行诊断治疗，期望能获得更好的治疗效果。

知识库在金融、教育等领域也可以有各种有效的应用。在进行金融风险检测时，
不一致性验证可以用来判断一个借款人的欺诈风险，这个跟交叉验证类似。比如借款人张三和借款人李四填写的是同一个公司电话，但张三填写的公司和李四填写的公司完全不一样，这就成了一个风险点，需要审核人员格外的注意。
除了贷前的风险控制，知识库也可以在贷后发挥其强大的作用。比如在贷后失联客户管理的问题上，知识库可以帮助我们挖掘出更多潜在的新的联系人，从而提高催收的成功率。

知识库也可以帮助我们分析用户和理解用户。通过结合多种数据源去分析实体之间的关系，从而对用户的行为有更好的理解。比如一个公司的市场经理用知识库来分析用户之间的关系，去发现一个组织的共同喜好，从而可以有针对性的对某一类人群制定营销策略。只有我们能更好的、更深入的理解用户的需求，我们才能更好地去做营销。

\section{知识库补全和推理}

当前知识库补全方法主要有两种方法：基于基于表示学习的知识库补全和基于符号逻辑的知识库补全。
基于表示学习的方法是通过学习实体和关系的低维度向量表示，
用向量的相似度计算预测实体之间的关系。常见的表示学习方法有TransE\cite{NIPS2013_5071}、TransH\cite{Wang2014KnowledgeGE}、
TransR\cite{Huang2017ImprovedKB}等，也有基于矩阵张量分解的表示学习方法如RESCAL\cite{Nickel2011}等。
基于符号逻辑的方法主要包括AMIE\cite{Galrraga2013AMIEAR}、PRA\cite{Lao2010}和SFE\cite{Gardner2015}等；其中，AMIE方法通过从知识库中挖掘关联规则进行知识库补全，
PRA方法基于连接实体的关系路径来预测它们之间的关系，SFE在PRA框架的基础上，
抽取更多隐藏的关系路径特征进行模型预测。

\subsection{基于表示学习的知识库补全}
\label{cha:presentation}
基于学习表示的知识库补全技术是近年来的研究热点之一。近年来获得了极大的关注热度。
这类知识库补全技术通过不同的目标函数，希望能学习到知识库中实体和关系的低维度向量表示。
这些实体的向量维度通常是50-300维度之间，将高维度稀疏的图数据张量，学习获得低维度的连续向量表示。
获得实体和关系的向量表示后，可以通过向量之间余弦距离计算实体-关系-实体相似度。

\subsubsection{RESCAL}
RESCAL是2011年在ICML上发表的一篇基于协同学习解决多关系知识库补全问题的方法。
将实体-关系-实体构建三维的张量矩阵。RESCAL基于潜藏模型，提供了一种有效的表示学习方法。
和其他表示学习模型不同，RESCAL这类模型更多借鉴推荐系统中张量分解算法，训练学习实体和关系的向量表示。
详细来说，RESCAL基于R阶的分解模型，$\chi_k$被分解为：
$$\chi_k \approx AR_{k}A^T, k =1...m$$
其中A表示一个$n\times r$的矩阵，表示n个实体和r种关系组成矩阵，$R_{k}$是一个$r\times r$的矩阵。
则只需要最小化函数：
$$\min \limits_{A,R_k} f(A,R_k)+g(A,R_k)$$
其中$f(A,R_k)$是度量$\chi_k$和$AR_{k}A^T$距离的函数。
$g(A,R_k)$是$A,R_k$的复杂度惩罚项。通过梯度下降等学习算法可以计算获得模型的参数。

其他类似进行知识库补全的方法还有张量分解机算法\cite{Rendle2010FactorizationM},
基于隐藏变量的张量分解机算法\cite{Rendle2012FactorizationMW}，结构化的低维表示\cite{2009EmbeddingLS}、无结构化的低维表示等。
基于张量分解模型和推荐系统等领域的协同过滤算法相似，都是从矩阵补全角度学习向量模型。
不同的是在知识库中，矩阵其实是由实体-关系-实体组成的三维张量，而推荐系统中的用户-商品矩阵是二维向量。
一些实验\cite{Dong2014}表明在稀疏的知识库图中，使用张量分解模型有较好的预测效果。

\subsubsection{TransE}
TransE是2013年谷歌发表在NIPS上的一篇论文，研究考虑如何将知识库中的多种不同的关系、实体，
学习获得它们的低维向量表示，期望能获得$h+r\approx t$效果，其中h和t分别是头实体和尾实体
学习到的低维向量，r是头实体和尾实体之间的关系向量表示。TransE模型定义了间隔损失函数：
$$L=\sum_{(h,r,t)\in S} \sum_{(h',r,t')\in S'}[\gamma+d(h+r,t)-d(h'+r,t')]_{+}$$

其中$\gamma$是间隔超参数，s是真实存在的知识库,$(h,r,t)$是这个知识库中的三元组
，$s'$是负例三元组组成的知识库实体，$(h',r,t')$表示负例三元组。$d(h+r,t)$表示头实体加上关系向量
和尾实体之间的欧氏距离。通过定义间隔损失函数，TransE期望学习的模型能保证正实例对比负实例对距离小，
这样就能保证正实例对比负实例对余弦相似度更高。

其他的算法如TransH和TransR都是基于TransE模型的基础上，通过学习更准确有效的损失函数来获得低维度向量表示。
TransH考虑一些关系中的映射属性知识，如一对一、一对多、多对多关系等，训练学习这些关系的低维度向量表示。
TransR\cite{Lin2015LearningEA}考虑实体和关系的多方面属性，在分割独立的向量空间中学习实体、关系的低维度向量表示。ProjE\cite{Shi2017ProjEEP}
基于神经网络的实体关系投影表示学习。

\subsection{基于符号逻辑的知识库补全}
\label{cha:symbolic}
基于逻辑符号的知识库补全算法也是多年来知识库补全和知识库推理中的关注热点之一。从90年代昆兰等人提出的规则归纳，
将观察集数据中的知识以规则的形式提炼出来，到近年来热门的基于路径排序算法（PRA）和子图特征抽取（SFE）的知识库推理补全。这类进行知识库补全的算法
多是利用符号逻辑，统计发现知识库图数据结构中存在的规则或规律，从而进行知识库补全预测。

\subsubsection{规则挖掘}
规则挖掘基于训练集知识库中的数据，通过挖掘知识库中隐藏的关联规则，进行知识发现和知识库补全。早期昆兰等人
提出了一阶逻辑推理的算法FOIL\cite{Quinlan1993FOILAM}，通过学习知识库中的例子来构建霍顿子句。如：
$$MotherOf(A,C)\land MarriedTo(A,B)\Rightarrow FatherOf(B,C)$$
就是一个典型的一阶逻辑推理。FOCL\cite{PAZZANI1991DetectingAC}等算法也是基于一阶逻辑推理构建的知识库搜索算法。
近年来随着互联网的快速发展，Schoenmackers\cite{Schoenmackers:2010}等人也将一阶逻辑逻辑推理用于互联网文本中。
其他规则挖掘的典型算法包括AMIE\cite{Galarraga2013},AMIE受关联规则启发，基于开放世界假设，在一阶逻辑推理的基础上，
能更快更高效的处理大规模的知识库数据，作者此后对AMIE算法进行改进获得AMIE+\cite{Galrraga2015FastRM}，这些算法在
YAGO知识库中获得了很好的效果。RDF2Rules\cite{Wang2015RDF2RulesLR}等算法也是基于逻辑推理，构建频繁的谓词圈，
获得了更加高效和准确的逻辑推理算法。

\subsubsection{路径排序算法}
路径排序算法\cite{Lao2010}是2010年，劳逆等人提出的知识库补全算法。在传统的一阶逻辑推理的基础上，
路径排序算法基于随机游走，在由知识库构成的图数据中查找更多、更长的有效的路径进行知识库推理，
和规则学习方法不同，路径排序算法在抽取图中的关系路径后，构建了分类学习器，通过分类器学习不同关系路径的权重。
利用每种关系下三元组的不同关系路径权重，来进行新关系事实的预测，从而构建了新的知识库补全算法。此外，作者还构建了基于反向
的随机游走图搜索算法\cite{Lao2015LearningRF}，进一步提升路径排序算法在知识库补全中的效果。考虑给定一个知识库关系$r_i$，
我们抽取所有具有这种关系的实体对构成集合：
$$R_i=\{{(h_{ij},t_{ij}),(h_{ij},r_i,t_{ij})\in KB}\}$$

随机游走查找路径后，我们抽取所有连接实体对$(h_{ij},t_{ij})$的路径类型$p_i$构成分类特征：
$$P_i=\{{p_i|(h_{ij},p_i,t_{ij})\in KB}\}$$

从而我们可以选择合适的分类器模型进行关系路径的训练学习，利用合适的路径类型来进行关系预测，知识库补全。

子图特征抽取\cite{Gardner2015}提供了一种更加简便有效的关系路径计算方法。相比于路径排序算法，子图特征抽取能获得更多的潜藏路径，
在进行关系预测的时候能获得更加显著有效的提升。此外，也有很多算法结合了子图特征抽取和表示学习算法\cite{Gardner2014}进行知识库补全。
一些算法对相似的关系进行聚类，构建多任务的路径排序模型\cite{Wang2016}。


\section{知识库补全相关假设}
知识库补全系统中，通常需要假定知识库中三元组正负实例对的正确性，或者在何种限制模式生成三元组负例。常用的有三种假设：（1）开放世界假说，（2）
封闭世界假说，（3）局部封闭世界假说。我们给定一个三元组集合$D^+$表示正例：
$$D^+=\{(h,r,t)|(h,t) \in KB\}$$

对于开放世界假说，给定一个知识库中的三元组集合，我们认为这些实际存在三元组是正例三元组，对于在知识库中不存在的三元组，
开放世界假说认为这个三元组是不确定的，可以通过概率大小预测这个三元组的正确性。

对于封闭世界假说，给定一个知识库三元组集合，我们认为只有知识库存在的三元组才是正例三元组。对于知识库中不存在的三元组，
封闭世界假说认为这些三元组是负例三元组。但通常这样会产生正负实例极其不平衡情况，每个知识库中存在三元组都能生成数百例
负例三元组。这些负例三元组组成负例集合$D^-$：
$$D^-=\{(h_j,r,t_i)|(h_i \ne h_j \wedge (h_i,t_i) \in KB)\}$$
$$ \cup \{(h_i,r,t_j)|(t_j \ne t_i \wedge(h_i,t_i) \in KB)\}$$

局部封闭世界假说对封闭世界假说进行了改进。给定一个关系，知识库中这个关系的三元组记为正例三元组，随机在这个关系中
替换头尾实体，生成这个关系下实体集合中错误的实体对，这样就可以大大减少所有负例三元组个数。基于局部封闭世界假设
构建的负例三元组集合$D^-$可以用如下公式表示：
$$D^-=\{(h_{ik},r_i,t_{ij})|(h_{ik} \ne h_{ij} \wedge (h_{ik},t_{ik}) \in KB  \wedge (h_{ij},t_{ij}) \in KB)\}$$
$$ \cup \{(h_{ij},r_i,t_{ik})|(t_{ij} \ne t_{ik} \wedge(h_{ik},t_{ik}) \in KB \wedge(h_{ij},t_{ij}) \in KB)\}$$

\section{评价方式}
\label{sec:metrics}
知识库补全效果的评价方法和信息检索类似，主要采用MAP和MRR\cite{Gardner2014}指标进行模型评价。同时考虑到在一个给定关系下，给定一个头实体和一系列的候选尾实体，我们希望排在前面的实体对是正确的实体对，
如果正例实体对排在负例实体对后面，则这个模型的预测效果有待改进。
所以我们借鉴了信息检索领域相关的评价方法，除了采用关键的MAP评价指标，
我们也采用了一些常见的AUC和Hit@1评价指标，希望能详尽的分析模型的有效性和可预测性。
本部分介绍了四类评价知识库补全的模型评估指标，包括：（1）hit@1，描述排序在第一位的正例三元组比例，（2）平均准确率MAP，衡量所有正例三元组在整个排序列表中的排序情况，值越大说明整体排序情况越好，（3）平均秩倒排序MRR,每组三元组中，正例三元组秩序排名，值越大越好；（4）AUC，使用二分类模型评价函数来预测知识库补全效果。

在信息检索中，hit@1表示每组三元组对应的正负实例中，正实例在该组正负例三元组中排名第一的三元组比例，
尽管这种评价指标较为简单，但可以有效衡量模型中正例三元组排在第一位比例。对于每个关系，
我们定义的的Hit@1计算公式如下：
$$hit@1=\frac{\sum_{q=1}^n{hit_q}}{n}$$
其中$hit_q$表示该关系下第$q$组实体对预测结果中，正例是否排名第一，
如果正例排名第一则$hit_q$为1，否则为0。

平均准确率的英文全称是mean average precision。MAP的衡量标准比较单一，给定一个头实体和一系列候选尾实体，头尾实体对之间的关系非0即1，
我们采用局部封闭世界假设，在知识库中存在的实体对标记为1，即为正例，否则为负例。
MAP核心是利用头实体对应的相关的尾实体出现的位置来进行排序算法准确性的评估。
它反映系统在全部相关文档上性能的单值指标。系统模型计算出来的实体对越靠前(rank 越高)，MAP就应该越高。否则准确率默认为0。MAP的计算公式如下：
$$MAP=\frac{\sum_{q=1}^nAP(q)}{n}$$
$$AP(q)=\frac{\sum_{i=1}^kP(i)\times rel(i)}{k}$$
其中MAP表示n个头实体和其候选尾实体的平均准确度的均值。AP(q)是一个头实体和其K个候选尾实体排序结果的评价，
如果正确的候选尾实体排在错误的候选尾实体之前，则AP值越高；
如果所有的头实体和其候选尾实体AP值越高，则模型的MAP值也就越高。
$rel(i)$在第i个实体对是预测结果时为1，否则为0。


MRR的全称是mean reciprocal rank。MRR通过定义第一个正确的候选尾实体来判断模型好坏，一个模型的MRR值越高，说明正确的候选尾实体在模型中排序越靠前。
MRR通常和MAP一起综合评价一个模型的好坏。
MRR的定义公式如下：
$$MRR=\frac{1}{n} \sum_{i=1}^n \frac{1}{r_i}$$

其中n表示一个关系下所有不同头实体的数目，$r_i$是每个头实体对应的正确尾实体的秩序。
MRR在很多基于问答系统的知识库补全系统\cite{West2014}中也是常见的评价方法之一。
通常情况下，基于符号逻辑的知识库补全系统中MRR值较高，多数实验结果都在0.9左右，大部分关系中的MRR实验结果差别不显著，
所以本研究的重点是关注如何显著提高知识库补全系统中关系补全的MAP指标。


除了常见的排序模型评价方式，我们在实验过程中也引入二分类分类器模型进行模型评价，
同时也考虑模型对正负例排序能力。AUC（Area Under Curve）被定义为ROC曲线（tpr和fpr曲线函数）下的面积，显然这个面积的数值不会大于1，同时这个值一般大于0.5。其中tpr和fpr的计算公式如下所示：
$$tpr=\frac{tp}{tp+fn}$$
$$fpr=\frac{fp}{fp+tn}$$
当你随机挑选一个正样本以及一个负样本，当前的分类算法根据计算得到的Score值将这个正样本排在负样本前面的概率就是AUC值。对所有实体对的预测得分进行排序，选择不同的阈值对正负例进行切分计算tpr和fpr的得分，从而绘制出完整的ROC曲线，并计算得到AUC的面积大小。AUC取值越大，当前的分类算法越有可能将正样本排在负样本前面，即能够更好的分类，整个模型的排序效果也更好。AUC计算公式如下所示：
$$auc=\int_{0}^{1}{tpr}*d{fpr}$$

在知识库补全预测中，无论是逻辑回归模型、支持向量机模型还是学习排序模型，
都需要关注模型的二分类的分类器性能问题。对于知识库中的实体对排序、实体对打分预测，
在评估一组实体对集合的排序秩序性能之外，也关注模型的分类性能好坏，
这些对于知识库补全算法是十分必要的。

\section{本章工作总结}

本部分介绍了当前知识库技术相关领域的一些重要研究内容，从知识库构建技术到知识库应用和发展，
我们学习研究了各种重要的知识库构建、推理、应用相关内容，介绍了如何评价知识库补全算法的相关指标。本部分重点关注了知识库补全算法相关的研究现状，基于符号逻辑和基于表示学习的知识库补全算法一直是相关领域的研究热点，本部分抓住这些研究中的重要公式、推理和相关假设，为构建我的知识库补全算法框架提供了坚实的基础。







